---
title: "Baseball Playoff Series Information"
author: "Angelica Morales & Gabriel Rodriguez"
date: "4/14/2022"
output: html_document
---

## Introduction
For the average person or baseball enthusiast, this project will break down the BLANK to better understand the relationship between BLANK and BLANK. The goal is to identify trends and characteristics of batting and pitching that affect the outcome of which team wins the series.

To explore this relationship, we will be using data about batting and pitching from the Lahman database, other resource, and other resource. Our approach is to make an analysis comparing different post season variables to study if there's a correlation between them. We will then take a closer look at which teams won and how they compare. The aim of this analysis is to uncover any new statistics and interpret it to the overall outcome of the winning teams.



## Data Preparation
```{r}
# Libraries we will be using for this exploration
library(tibble) #to create tibbles
library(tidyverse) # multiple tidy up data packages
library(ggplot2) # for data visualization
library(Lahman) #baseball database
```
The Lahman Baseball Database was obtained from R Studio. It was collected by Sean Lahman who compiled the data. It began as an effort to collect baseball information in one place for personal use. As a freelance writer and baseball enthusiast, Sean Lahman found that having this sort of information at his fingertips was an invaluable resource.

## Postseason Batting Data
Before we can use the 'BattingPost' data table we need clean it up a bit. First we want to remove any missing data. There is no data available for the 'CS', 'HBP', 'SH', 'SF', and 'GIDP' columns for years 1884-1892, so we will remove data for these years. We will also rename the 'round' column to 'Playoff_Series' to make it more understandable.
```{r}
PostSeries_Batting <- BattingPost %>% 
  na.exclude() %>% 
  rename("Playoff_Series" = round)
```

Second, we will add more relevant baseball calculations that will help us better analyze batting performance.

Finally we will take a look at the means of those statistic for all teams, for each individual playoff series from 2012-2019. 


```{r}
# The 'BattingPost' data frame contains batting information for each MLB postseason game for years 1884-2020.
view(BattingPost)
BattingPost <-BattingPost
```


```{r}
# Let's take a look at summarized statistics for each different playoff series
# Remove all observations for which data is missing. Rename 'round' column to 'Playoff Series'
PostSeries_Batting <- BattingPost %>% 
  na.exclude() %>% 
  rename("Playoff_Series" = round)
```

This table already contains a lot of relevant baseball statistics. However it is missing important calculations that are commonly used to determine batting performance.
Fortunately, the data needed to perform these calculations is already in the table, so all we have to do is add columns that perform these calculations. More specifically, we will want to look at batting average (AVG), on-base percentage (OBP), slugging (SLG), and on-base plus slugging (OPS).

```{r}
# Add columns that calculate more batting statistics
PostSeries_Batting <- PostSeries_Batting %>% 
  filter(AB > 0) %>%                                              # We only want batting info for players who had at least one AB
  mutate(X1B = (H - (X2B + X3B + HR)),                            # Add a column for singles hit
         TB = (1*X1B) + (2*X2B) + (3*X3B) + (4*HR),               # Add a column for totatl bases
         AVG = H/AB,                                              # Add a batting average column
         OBP = (H + HBP + BB + IBB) / (AB + BB + IBB + HBP + SF), # Add an on-base percentage column
         SLG = TB / AB,                                           # Add a slugging percentage column
         OPS = OBP + SLG)                                         # Add an on-base plus slugging column

         
         
# Remove base running statistics. We won't need those for batting statistics purposes
PostSeries_Batting <- PostSeries_Batting %>% select(-SB, -CS)

# Rearrange columns
PostSeries_Batting <- PostSeries_Batting %>%
  relocate(TB, AVG, OBP, SLG, OPS, .after = BB)

```


**Overall means for batting average (AVG), on-base percentage (OBP), slugging (SLG),** 
**and on-base plus slugging (OPS), for each individual postseason series during the** 
**expanded wild card era (2012-2019)**
```{r}
# Let's focus on the expanded wild card era years 2012-2019
# Compare the batting average among each playoff series

# This function takes in our 'PostSeries_Batting' df, groups_by 'Playoff_Series', then
# summarizes the mean of the chosen stat for each different playoff series, within the 
# chosen start_year and end_year

Stat_Mean <- function(dataset, Playoff_Series, stat_name, start_year, end_year) {
  Playoff_Series <- enquo(Playoff_Series)
  stat_name <- enquo(stat_name)
  
  dataset %>%
  filter(yearID >= start_year & yearID <= end_year) %>%
  group_by(!!Playoff_Series) %>%
  summarize(series_mean = mean(!!stat_name)) %>%
  arrange(-series_mean)
}
  
# Use the 'Stat_Mean' function to calculate the mean AVG, OBP, SLG, and OPS
# for each playoff series for years 2012-2019
Series_AVG <- Stat_Mean(PostSeries_Batting, Playoff_Series, AVG, 2012, 2019)  
Series_OBP <- Stat_Mean(PostSeries_Batting, Playoff_Series, OBP, 2012, 2019)  
Series_SLG <- Stat_Mean(PostSeries_Batting, Playoff_Series, SLG, 2012, 2019)
Series_OPS <- Stat_Mean(PostSeries_Batting, Playoff_Series, OPS, 2012, 2019)
 
```

```{r}
# Plot the results
Series_AVG %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("Batting Average Mean for Individual Playoff Series (2012-2019)") +
  xlab("Playoff Series") +
  ylab("Batting Average")


Series_OBP %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("On-Base Percentage Mean for Individual Playoff Series (2012-2019)") +
  xlab("Playoff Series") +
  ylab("On-base Percentage")


Series_SLG %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("Slugging Percentage Mean for Individual Playoff Series (2012-2019)") +
  xlab("Playoff Series") +
  ylab("Slugging Percentage")


Series_OPS %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("On-base Plus Slugging Mean for Individual Playoff Series (2012-2019)") +
  xlab("Playoff Series") +
  ylab("On-base Plus Slugging")
```


## Postseason Pitching Data

```{r}

# The 'PitchingPost' data frame contains pitching information for each MLB postseason game for years
# 1884-2020.
view(PitchingPost)
PitchingPost <-PitchingPost

# Let's take a look at summarized statistics for each different playoff series

# Remove all observations for which data is missing. Rename 'round' column to 'Playoff Series'
PostSeries_Pitching <- PitchingPost %>% 
  na.exclude() %>% 
  rename("Playoff_Series" = round)



```


```{r}
# Add columns that calculate more pitching statistics
PostSeries_Pitching <- PostSeries_Pitching %>% 
  mutate(IP = IPouts / 3,                    # Calculate the number of innings pitched
         WHIP = (H + BB + IBB) / IP) %>%     # Calculate the walks/hits per inning pitched
  filter(IP > 0)       


```


```{r}

# Use the stat_mean function to visualize the mean for ERA, IP, and WHIP form 2012-2019

Series_ERA <- Stat_Mean(PostSeries_Pitching, Playoff_Series, ERA, 2012, 2019)
Series_IP <- Stat_Mean(PostSeries_Pitching, Playoff_Series, IP, 2012, 2019)
Series_WHIP <- Stat_Mean(PostSeries_Pitching, Playoff_Series, WHIP, 2012, 2019)


```

```{r}
# Plot the results
Series_ERA %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("Earned Run Average for Individual Playoff Series (2012-2019") +
  xlab("Playoff Series") +
  ylab("Earned Run Average (ERA)")


Series_IP %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("Innings Pitched Mean for Individual Playoff Series (2012-2019") +
  xlab("Playoff Series") +
  ylab("Innings Pitched (IP)")


Series_WHIP %>% ggplot(aes(x = reorder(Playoff_Series, -series_mean), y = series_mean)) + geom_col() +
  ggtitle("Walks/Hits Per IP Mean for Individual Playoff Series (2012-2019") +
  xlab("Playoff Series") +
  ylab("Walks/Hits Per Inning Pitched (WHIP)")



```

Now that we have the means for these batting/pitching statistics, we can compare them to the means of those statistics for teams that won each round. 

```{r}

# Determine the Winning and Losing Teams for each playoff series during 2012-2019
SeriesPost_2012_2019 <- SeriesPost %>% filter(yearID >= 2012 & yearID <= 2019)

# Filter our 'PostSeries_Batting' data for years 2012-2019
Bat_2012_2019 <- PostSeries_Batting %>% filter(yearID >= 2012 & yearID <=2019)

left_join(Bat_2012_2019, SeriesPost_2012_2019, by = c("teamID" = "teamIDwinner"))


```

