---
title: "Batting Average or Home Runs to Win the World Series?"
author: "Angelica Morales & Gabriel Rodriguez"
date: "4/24/2022"
output: html_document
---
# Introduction

Since it's inception in 1903, being crowned the World Series champion has been the goal of any team in Major League
Baseball. Since then, professional baseball has gone through a multitude of different changes that have evolved it 
into the very technologically and analytically driven sport that exists today. 

<<<<<<< HEAD
In which series were there more homeruns? In which year was there the most homeruns in the series from question from before.
=======
All those things have changed, but one of the few things that remains the same, is the World Series; a best of seven game
series played between the two different league champions to determine who will be that season's champion. 

What this project hopes to accomplish is to observe the trends (if any), in batting average and home runs during the world
series, as well as look at the relationship between batting average and home runs between the winning and losing teams. 
Any trends will help us predict what kind of batting average and home run number we can expect in future World Series', and
any relationship between batting average and total home runs hits, will help us determine which of those statistics are more
important to winning the World Series.
>>>>>>> a6077b1db5abb8037c6e60240c367e88becf3df3

For the purposes of this project we will be looking at World Series' played after 1922, as this is the year that the series
became a best of seven games series, and we will also only look at batting data for World Series' in which the full seven
games were played so as to limit how skewed our data will be. 


## The big question? 

What trends exist in batting average, and total home runs hit, in the World Series?
Is team batting average, or total home runs hit a better indicator of which team will win the World Series. 



## Packages Used
```{r}

# Libraries we will be using for this exploration
<<<<<<< HEAD
library(tibble) #to create tibbles
library(tidyverse) # multiple tidy up data packages
library(ggplot2) # for data visualization
library(Lahman) #baseball database
library(gridExtra)
```
The Lahman Baseball Database was obtained from R Studio. It was collected by Sean Lahman who compiled the data. It began as an effort to collect baseball information in one place for personal use. As a freelance writer and baseball enthusiast, Sean Lahman found that having this sort of information at his fingertips was an invaluable resource.
=======
>>>>>>> a6077b1db5abb8037c6e60240c367e88becf3df3

library(tidyverse)
library(ggplot2)
library(Lahman)

```

## Data Used

The data used comes from the 'Lahman' baseball database. The Lahman Database was created by Sean Lahman; 
an investigative journalist for the USA Today Network, sports columnist for the New York Sun, and data
projects manager for the Society of American Baseball Research. Lahman has also served as editor 
and contributor in several sports reference books.
   
For the purposes of this project we will be utilizing the 'BattingPost' table which includes individual 
player batting statistics for each different MLB postseason round from 1903 through 2020. 

The 'BattingPost' table contains a total of  15,460 unique observations. Each observation contains data
that pertains to 22 different variables

```{r}
as_tibble(view(BattingPost))

```

The 'SeriesPost' table contains a total of 358 unique observations. Each observation contains data that 
pertains to 9 different variables. This table tells us the winning and losing teams for each postseaon
round from 1884-2020, as well has what leagues they belonged to, and how many games they won/lost. 

```{r}

as_tibble(view(SeriesPost))

```


## Data Cleaning/Tidying


```{r, echo=FALSE}


# We only want to look at World Series 'WS' batting info from 1922-2020. The WS was first played in 1903 but
# didn't become a best of seven games series until 1922. Let's also remove the 'playerID' column as
# we will not need to know any individual player's name. 

WS_Batting <- BattingPost %>%
  filter(round == "WS", 
         yearID >= 1922 & yearID <= 2020) %>%
  select(yearID, round, teamID, G, AB, H, HR)


```



```{r, echo=FALSE}
# Add batting average statistic
# We will also add 
 WS_Batting <- WS_Batting %>% 
  filter(AB > 0) %>%
   mutate("Bat_Avg" = H / AB,
          "AB_HR" = ifelse(HR > 0, AB / HR, 0))
```

```{r, echo=FALSE}
# Filter the 'SeriePost' for WS from 1922-2020. Add a column to determine the total number of games played
# in each World Series, then remove unecessary columns.

WS_results <- SeriesPost %>%
  mutate("games_played" = wins + losses) %>%
  filter(round == "WS", 
         yearID >= 1922 & yearID <= 2020,
         games_played == 7) %>%
  select(yearID, round, teamIDwinner, teamIDloser, games_played)

```

```{r, echo=FALSE}
# We will use the 'inner_join' function to join our 'WS_Batting' table with the 'Series_Winner' table on the 'yearID',
# and 'teamID' = 'teamIDwinner' columns. This will return a table that contains only the batting information for 
# the World Series winners.

WS_Batting <- left_join(WS_Batting, WS_results, by = c("yearID", "round")) %>% 
  filter(games_played == 7) %>%
  select(-games_played)
```

```{r, echo=FALSE}
# Add a won/lost column

WS_Batting <- WS_Batting %>% 
  mutate(Won.Lost = if_else(as.character(.$teamID) == as.character(.$teamIDwinner), 'Won', 'Lost'))

```


## Data Exploration


Let's get some historical context first, and see how many World Series' have been played out to the maximum
7 games.

There have been 39 World Series' between 1922-2020 in which all seven games have been played. 
```{r}

WS_Batting %>% group_by(yearID) %>% summarize(n = n()) %>% n_distinct()

```

What were the total number of Home Runs hit by each team, mean batting average, and mean AB per HR ratio?

```{r}

# Total number of home runs, mean Batting Average, mean At-Bats per Home Run Ratio

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR))


```
<<<<<<< HEAD
## Postseason Pitching Data
=======

### Trends in Batting Average and Total Home Runs Hit

**What trend if any exists, in total home runs being hit during the World Series?**
>>>>>>> a6077b1db5abb8037c6e60240c367e88becf3df3


```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot() +
  geom_col(aes(x = yearID, y = Total_HR, fill = Won.Lost), position = "dodge") +
  geom_smooth(aes(x = yearID, y = Total_HR)) +
  labs(title = "Total Home Runs Hit in WS",
       subtitle = "(For WS Where All 7 Games Were Played)") +
  xlab("Year Played") +
  ylab("Total Home Runs Hit")


```
 
 
 More World Series games went to a decisive game 7 between the 25 year time span of 1950-1975. 
 
 There have not been many World Series played, that require all 7 games, in the last 20 years,
 but we have seen more total home runs hit by **both** winning and losing teams in those games. 
 
**What trend if any exists, in batting average during the World Series?**

```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot() +
  geom_point(aes(x = yearID, y = mean_Bat_Avg, color = Won.Lost), position = "dodge") +
  geom_smooth(aes(x= yearID, y = mean_Bat_Avg), method = lm) +
  labs(title = "Team Batting Average in WS",
       subtitle = "(For WS Where All 7 Games Were Played)") +
  xlab("Year Played") +
  ylab("Team Batting Average") +
  facet_wrap(~Won.Lost)


```

Batting average for losing World Series teams is gradually decreasing.

Batting average for winning World Series teams is gradually increasing. 


**What trend if any exists, in batting average during the World Series?**

```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot() +
  geom_point(aes(x = yearID, y = mean_AB_HR, color = Won.Lost), position = "dodge") +
  geom_smooth(aes(x= yearID, y = mean_AB_HR), method = lm) +
  labs(title = "At-bat per Home Run Ratio in WS",
       subtitle = "(For WS Where All 7 Games Were Played)") +
  xlab("Year Played") +
  ylab("At-Bat to Homerun Ratio") +
  facet_wrap(~Won.Lost)

```


At-bat to home run ratio is increasing at a similar rate for both losing and winning teams. This means that we are 
more likely to see a homerun in fewer at-bats today, then we were in the past. 

<<<<<<< HEAD
# Use the stat_mean function to visualize the mean for ERA, IP, and WHIP from 2012-2019
Series_ERA <- Stat_Mean(PostSeries_Pitching, Playoff_Series, ERA, 2012, 2019)
Series_IP <- Stat_Mean(PostSeries_Pitching, Playoff_Series, IP, 2012, 2019)
Series_WHIP <- Stat_Mean(PostSeries_Pitching, Playoff_Series, WHIP, 2012, 2019)
=======

**What is the relationship between batting average and home runs hit?**
>>>>>>> a6077b1db5abb8037c6e60240c367e88becf3df3

```{r}
WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot(aes(x = Total_HR, y = mean_Bat_Avg, fill = Won.Lost)) +
  geom_boxplot(alpha = .3) +
  facet_wrap(~ Won.Lost) +
  labs(title = "Batting Avg vs. Total HR Hit") +
  xlab("Total HR Hit") +
  ylab("Team Batting Average")

```




**What is the  relationship between batting average and at-bats per homerun ratio.**

```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot(aes(x = mean_Bat_Avg, y = mean_AB_HR, color = Won.Lost)) +
  geom_point(alpha = .7) +
  geom_smooth() +
  facet_wrap(~ Won.Lost) +
  labs(title = "Batting Avg vs. AB per HR Ratio") +
  xlab("Team Batting Average") +
  ylab("At-bat per Home Run Ratio")

```

There is no discernible trend between mean batting average and mean at-bat per home run ratio between winning and 
losing teams. However, with the use of a line, we can see that winning teams have a 'flatter' line. This flat line 
tells us that winning team's at-bat per home run ratio is more evenly distributed among their batting average.



**With what frequency are winning teams hitting home runs**


```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot(aes(x = Total_HR, fill = Won.Lost)) +
  geom_density(alpha = .3) +
  facet_wrap(~ Won.Lost) +
  labs(title = "Total Home Runs Hit") +
  xlab("Number of Home Runs")

```

**What is this graph telling us?**
The frequency in total number of home runs hit by losing and winning teams hit home runs is very identical.



```{r}

WS_Batting %>% group_by(yearID, teamID, Won.Lost) %>% 
  summarize("Total_HR" = sum(HR),
            'mean_Bat_Avg' = mean(Bat_Avg),
            "mean_AB_HR" = mean(AB_HR)) %>%
  ggplot(aes(x = mean_Bat_Avg, fill = Won.Lost)) +
  geom_density(alpha = .3) +
  #facet_wrap(~ Won.Lost) +
  labs(title = "Team Batting Average") +
  xlab("Team Batting Average")

```

The winning teams hit for a higher batting average more frequently than the losing teams.

## Results and Conclusion

There have been a total of 39 World Series' from 1922-2020 in which a seventh game was needed to crown
a champion. 

### Trends
We can see different trends for total home runs hit, team batting average,  and at-bat per home run ratios
during this time. 

**Total Home Runs Hit** - With the exception of the the dip in home runs hit 